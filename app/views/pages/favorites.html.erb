<div class="favorite-container">
  <div class="d-flex align-items-center mb-4 position-relative">
    <div class="back-icon">
      <%= link_to dashboard_path do %>
        <i class="fa-solid fa-chevron-left"></i>
      <% end %>
    </div>
    <h2 class="title-favorite">MES FAVORIS</h2>
  </div>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
    <% @favorites.each do |perfume| %>
      <div class="col">
        <div class="card h-100">
          <%= link_to perfume_path(perfume), class: "text-decoration-none text-dark" do %>
            <div class="position-relative">
              <% if perfume.illustration.attached? %>
                <%= cl_image_tag perfume.illustration.key, alt: perfume.name, class: "img-fluid" %>
              <% else %>
                <img src="<%= perfume.photo %>" class="card-img-top" alt="<%= perfume.name %>">
              <% end %>
              <% if current_user.favorites.exists?(perfume: perfume) %>
                <%= link_to perfume_favorite_path(perfume, current_user.favorites.find_by(perfume: perfume)), method: :delete, class: "position-absolute top-0 end-0 btn btn-link" do %>
                  <i class="fa-solid fa-heart fa-2x"></i>
                <% end %>
              <% else %>
                <%= link_to perfume_favorites_path(perfume_id: perfume.id), method: :post, class: "position-absolute top-0 end-0 btn btn-link" do %>
                  <i class="fa-regular fa-heart fa-2x"></i>
                <% end %>
              <% end %>
            </div>
            <div class="card-body">
              <h5 class="card-title"><%= perfume.name %></h5>
              <p class="card-text"><strong><%= perfume.brand %></strong></p>
              <p class="card-text-price"><%= number_to_currency(perfume.price, unit: "â‚¬") %></p>
              <p class="card-text">Avis (<%= perfume.reviews.count %>)</p>
              <div class="rating">
                <% average_rating = perfume.reviews.average(:rating).to_f.round(1) %>
                <% average_rating.to_i.times do %>
                  <i class="bi bi-star-fill"></i>
                <% end %>
                <% (5 - average_rating.to_i).times do %>
                  <i class="bi bi-star"></i>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
